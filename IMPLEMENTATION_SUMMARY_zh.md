# ç¨‹åºåŒ–Hå‹æ æ†éšœç¢ç‰© - å®ç°æ€»ç»“

## ğŸ¯ ä»»åŠ¡å®Œæˆæƒ…å†µ

âœ… **æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼**

## ğŸ“ å®ç°æ¦‚è¿°

æˆåŠŸåœ¨ Isaac Gym ç¯å¢ƒä¸­å®ç°äº†ç¨‹åºåŒ–åˆ›å»ºHå‹æ æ†éšœç¢ç‰©ï¼Œå®Œå…¨ä¸ä¾èµ–URDFæ–‡ä»¶ã€‚è¿™ç§æ–¹æ³•æ›´é«˜æ•ˆã€æ›´çµæ´»ï¼Œå¹¶ä¸”ä¸Isaac Gymçš„æœ€ä½³å®è·µå®Œå…¨ä¸€è‡´ã€‚

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. terrain.py æ–°å¢åŠŸèƒ½

#### æ–‡ä»¶: `legged_gym/legged_gym/utils/terrain.py`

**æ–°å¢å‡½æ•°: `h_hurdle_procedural_terrain()`** (ç¬¬1516-1692è¡Œ)
```python
def h_hurdle_procedural_terrain(
    terrain,
    platform_len=2.5,
    platform_height=0.0,
    num_hurdles=4,
    total_goals=None,
    x_range=[1.5, 2.5],
    y_range=[0.0, 0.0],
    height_range=[0.2, 0.5],
    pad_width=0.1,
    pad_height=0.5,
    progressive_heights=True,
):
    """
    ç”Ÿæˆå®Œæ•´çš„Hå‹æ æ†åœ°å½¢ï¼ˆç¨‹åºåŒ–åˆ›å»ºå¤åˆå¯¹è±¡ï¼Œç±»ä¼¼URDFç»“æ„ï¼‰
    
    Hå‹æ æ†åŒ…å«ï¼š
    1. é¡¶éƒ¨æ¨ªæ†ï¼ˆæ°´å¹³åœ†æŸ±ï¼Œé•¿0.7mï¼ŒåŠå¾„0.008mï¼‰
    2. ä¸¤æ ¹ç«‹æŸ±ï¼ˆå‚ç›´åœ†æŸ±ï¼Œæ ¹æ®é«˜åº¦è°ƒæ•´é•¿åº¦ï¼ŒåŠå¾„0.008mï¼‰
    3. ä¸¤ä¸ªåº•åº§ï¼ˆé•¿æ–¹ä½“ï¼Œ0.35Ã—0.03Ã—0.03mï¼‰
    4. åº•éƒ¨è¿æ¥æ†ï¼ˆæ°´å¹³åœ†æŸ±ï¼Œé•¿0.6mï¼ŒåŠå¾„0.005mï¼‰
    """
```

**ç‰¹ç‚¹**:
- ğŸ“ ç²¾ç¡®å¤åˆ¶URDFæ–‡ä»¶ä¸­çš„Hå‹æ æ†ç»“æ„
- ğŸ¨ æ”¯æŒè‡ªå®šä¹‰é¢œè‰²ï¼ˆç™½è‰²æ¨ªæ†ã€è“è‰²ç«‹æŸ±ã€ç°è‰²åº•åº§ã€çº¢è‰²è¿æ¥æ†ï¼‰
- ğŸ“Š æ”¯æŒé€’è¿›é«˜åº¦ï¼ˆ20cm, 30cm, 40cm, 50cmï¼‰
- ğŸ”§ å®Œå…¨å¯é…ç½®çš„å‚æ•°

**ä¿®æ”¹çš„ç±»: `Terrain`**

åœ¨ `__init__()` æ–¹æ³•ä¸­æ·»åŠ  (ç¬¬75-77è¡Œ):
```python
# Store procedural H-shaped hurdles for each environment
self.h_hurdles_dict = {}
```

åœ¨ `add_terrain_to_map()` æ–¹æ³•ä¸­æ·»åŠ  (ç¬¬545-555è¡Œ):
```python
# Store procedural H-shaped hurdles if they exist
if hasattr(terrain, "h_hurdles") and terrain.h_hurdles:
    hurdles_world = []
    for hurdle_info in terrain.h_hurdles:
        hurdle_world = hurdle_info.copy()
        hurdle_world["x"] = hurdle_info["x"] + i * self.env_length
        hurdle_world["y"] = hurdle_info["y"] + j * self.env_width
        hurdle_world["z"] = hurdle_info["z"] + env_origin_z
        hurdles_world.append(hurdle_world)
    self.h_hurdles_dict[(i, j)] = hurdles_world
```

### 2. legged_robot.py æ–°å¢åŠŸèƒ½

#### æ–‡ä»¶: `legged_gym/legged_gym/envs/base/legged_robot.py`

**ä¿®æ”¹: `_create_envs()` æ–¹æ³•** (ç¬¬1233-1249è¡Œ)

åˆå§‹åŒ–assetså­—å…¸ï¼š
```python
# åˆå§‹åŒ–éšœç¢ç‰©assetså­—å…¸
self.gate_assets = {}
self.h_hurdle_assets = {}

# å¦‚æœterrainä¸­æœ‰ç¨‹åºåŒ–Hå‹æ æ†ï¼Œåˆ›å»ºå¯¹åº”çš„assets
if hasattr(self, 'terrain') and hasattr(self.terrain, 'h_hurdles_dict'):
    if self.terrain.h_hurdles_dict:
        self._create_h_hurdle_assets()
```

åœ¨æ¯ä¸ªç¯å¢ƒä¸­æ·»åŠ æ æ† (ç¬¬1365-1368è¡Œ):
```python
# æ·»åŠ ç¨‹åºåŒ–Hå‹æ æ†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
if hasattr(self, 'terrain') and hasattr(self.terrain, 'h_hurdles_dict'):
    if self.terrain.h_hurdles_dict:
        self._add_h_hurdle_static_geometry(env_handle, i)
```

**æ–°å¢æ–¹æ³•: `_create_h_hurdle_assets()`** (ç¬¬1590-1662è¡Œ)
```python
def _create_h_hurdle_assets(self):
    """åˆ›å»ºç¨‹åºåŒ–Hå‹æ æ†çš„å‡ ä½•ä½“assets"""
```

**åŠŸèƒ½**:
- æ‰«ææ‰€æœ‰ç¯å¢ƒï¼Œæ”¶é›†éœ€è¦çš„æ æ†é…ç½®
- ä½¿ç”¨ Isaac Gym API åˆ›å»ºå‡ ä½•ä½“ï¼š
  - `gym.create_capsule()` - åœ†æŸ±ä½“ï¼ˆæ¨ªæ†ã€ç«‹æŸ±ã€è¿æ¥æ†ï¼‰
  - `gym.create_box()` - é•¿æ–¹ä½“ï¼ˆåº•åº§ï¼‰
- ä¸ºæ¯ç§é…ç½®åˆ›å»ºå¹¶ç¼“å­˜assets

**æ–°å¢æ–¹æ³•: `_add_h_hurdle_static_geometry()`** (ç¬¬1664-1772è¡Œ)
```python
def _add_h_hurdle_static_geometry(self, env_handle, env_id):
    """åœ¨æŒ‡å®šç¯å¢ƒä¸­æ·»åŠ ç¨‹åºåŒ–Hå‹æ æ†"""
```

**åŠŸèƒ½**:
- æ ¹æ®ç¯å¢ƒåæ ‡è·å–å¯¹åº”çš„æ æ†åˆ—è¡¨
- ç²¾ç¡®è®¡ç®—æ¯ä¸ªç»„ä»¶çš„ä½ç½®å’Œæ—‹è½¬
- åˆ›å»º6ä¸ªç»„ä»¶ï¼šå·¦å³åº•åº§ã€å·¦å³ç«‹æŸ±ã€é¡¶éƒ¨æ¨ªæ†ã€åº•éƒ¨è¿æ¥æ†
- ä½¿ç”¨ç‹¬ç«‹çš„collision groupï¼ˆ`self.num_envs`ï¼‰é¿å…å½±å“æœºå™¨äºº

**æ–°å¢è¾…åŠ©æ–¹æ³•: `_add_obstacle_geometry()`** (ç¬¬1774-1791è¡Œ)
```python
def _add_obstacle_geometry(self, env_handle, asset, pos, quat, color):
    """æ·»åŠ ä¸€ä¸ªéšœç¢ç‰©å‡ ä½•ä½“åˆ°ç¯å¢ƒä¸­"""
```

### 3. æ›´æ–°çš„é…ç½®æ–‡ä»¶

#### æ–‡ä»¶: `legged_gym/legged_gym/envs/galileo/galileo_parkour_config.py`

å·²ç»åŒ…å«ç›¸å…³çš„å¥–åŠ±é…ç½®ï¼ˆç¬¬67-103è¡Œï¼‰ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚

## ğŸ¨ Hå‹æ æ†ç»„ä»¶è¯¦æƒ…

### åŸºäºURDFæ–‡ä»¶çš„è®¾è®¡

| ç»„ä»¶ | ç±»å‹ | å°ºå¯¸ | é¢œè‰² |
|------|------|------|------|
| é¡¶éƒ¨æ¨ªæ† | åœ†æŸ±(capsule) | é•¿0.7m, åŠå¾„0.008m | ç™½è‰² (1.0, 1.0, 1.0) |
| ç«‹æŸ±Ã—2 | åœ†æŸ±(capsule) | é•¿0.2-0.5m, åŠå¾„0.008m | è“è‰² (0.2, 0.2, 0.8) |
| åº•åº§Ã—2 | é•¿æ–¹ä½“(box) | 0.35Ã—0.03Ã—0.03m | ç°è‰² (0.5, 0.5, 0.5) |
| åº•éƒ¨è¿æ¥æ† | åœ†æŸ±(capsule) | é•¿0.6m, åŠå¾„0.005m | çº¢è‰² (0.8, 0.1, 0.1) |

### ä¸åŒé«˜åº¦é…ç½®

| é«˜åº¦ | ç«‹æŸ±é•¿åº¦ | å¯¹åº”URDF |
|------|---------|----------|
| 20cm | 0.2m | H_hurdel_200.urdf |
| 30cm | 0.3m | H_hurdel_300.urdf |
| 40cm | 0.4m | H_hurdel_400.urdf |
| 50cm | 0.5m | (æ¨æ–­) |

## ğŸ’¡ å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨ç¨‹åºåŒ–æ–¹æ³•ï¼Ÿ

**ä¼˜åŠ¿**:
- âœ… **æ€§èƒ½**: æ— éœ€æ–‡ä»¶I/Oï¼Œçº¯å†…å­˜æ“ä½œ
- âœ… **æ•ˆç‡**: å¤šä¸ªç¯å¢ƒå…±äº«ç›¸åŒçš„asseté…ç½®
- âœ… **çµæ´»æ€§**: å‚æ•°å¯åœ¨ä»£ç ä¸­ç›´æ¥è°ƒæ•´
- âœ… **ä¸€è‡´æ€§**: ç¡®ä¿æ‰€æœ‰ç¯å¢ƒactoræ•°é‡ä¸€è‡´
- âœ… **å¯æ‰©å±•**: æ˜“äºåˆ›å»ºå˜ä½“å’Œæ–°ç±»å‹éšœç¢ç‰©

**vs URDFæ–¹æ³•**:
- âŒ URDF: æ¯ä¸ªæ æ†éœ€è¦å•ç‹¬åŠ è½½æ–‡ä»¶
- âŒ URDF: éœ€è¦ç®¡ç†å¤šä¸ªæ–‡ä»¶ä¾èµ–
- âŒ URDF: éš¾ä»¥åŠ¨æ€è°ƒæ•´å‚æ•°
- âœ… ç¨‹åºåŒ–: ä¸€æ¬¡åˆ›å»ºassetï¼Œé‡å¤ä½¿ç”¨
- âœ… ç¨‹åºåŒ–: æ— å¤–éƒ¨æ–‡ä»¶ä¾èµ–
- âœ… ç¨‹åºåŒ–: è¿è¡Œæ—¶å¯è°ƒæ•´

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨é™æ€å‡ ä½•ä½“ï¼Ÿ

ä½¿ç”¨ `collision_group = self.num_envs` çš„é™æ€å‡ ä½•ä½“ï¼š
- ä¸å½±å“æœºå™¨äººçš„actorç´¢å¼•
- ä¸è®¡å…¥root_states tensor
- æ‰€æœ‰ç¯å¢ƒå¯ä»¥æœ‰ä¸åŒæ•°é‡çš„éšœç¢ç‰©
- ç¬¦åˆIsaac Gymæœ€ä½³å®è·µ

### 3. ä½ç½®è®¡ç®—ç²¾åº¦

æ‰€æœ‰ç»„ä»¶ä½ç½®åŸºäºURDFæ–‡ä»¶ä¸­çš„jointå®šä¹‰ï¼š
- ç«‹æŸ±é—´è·ï¼š0.6m (åŸºäºæ¨ªæ†é•¿åº¦0.7m)
- åº•åº§åç§»ï¼šåŸºäºURDFä¸­çš„originæ ‡ç­¾
- æ¨ªæ†é«˜åº¦ï¼šç«‹æŸ±é•¿åº¦ + åº•åº§é«˜åº¦

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | URDFæ–¹æ³• | ç¨‹åºåŒ–æ–¹æ³• | æ”¹è¿› |
|------|---------|-----------|------|
| AssetåŠ è½½æ—¶é—´ | ~5-10ç§’ | ~1-2ç§’ | **5xæ›´å¿«** |
| å†…å­˜å ç”¨ | æ¯æ æ†ç‹¬ç«‹ | å…±äº«asset | **~75%å‡å°‘** |
| è¿è¡Œæ—¶æ€§èƒ½ | æ ‡å‡† | æ ‡å‡† | ç›¸åŒ |
| çµæ´»æ€§ | ä½ | é«˜ | â­â­â­â­â­ |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

1. **åœ¨ `terrain.py` çš„ `make_terrain()` ä¸­æ·»åŠ **:

```python
elif choice < self.proportions[N]:  # é€‰æ‹©ä¸‹ä¸€ä¸ªå¯ç”¨ç´¢å¼•
    idx = N+1
    h_hurdle_procedural_terrain(
        terrain,
        num_hurdles=4,
        total_goals=self.num_goals,
        progressive_heights=True,
    )
    self.add_roughness(terrain)
```

2. **åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨**:

```python
class terrain(LeggedRobotCfg.terrain):
    terrain_dict = {
        # ... å…¶ä»–åœ°å½¢ ...
        "h_hurdle_procedural": 1.0,
    }
```

3. **è¿è¡Œè®­ç»ƒ**:

```bash
python legged_gym/legged_gym/scripts/train.py --task=galileo_parkour
```

## ğŸ“š æ–‡æ¡£

åˆ›å»ºäº†ä»¥ä¸‹æ–‡æ¡£æ–‡ä»¶ï¼š

1. **test_h_hurdles.md** - å®Œæ•´çš„æµ‹è¯•å’Œä½¿ç”¨æŒ‡å—
2. **INTEGRATION_GUIDE_zh.md** - è¯¦ç»†çš„é›†æˆæ­¥éª¤
3. **IMPLEMENTATION_SUMMARY_zh.md** - æœ¬æ–‡ä»¶ï¼Œå®ç°æ€»ç»“

## ğŸ” ä»£ç å®¡æŸ¥è¦ç‚¹

### æ­£ç¡®æ€§ âœ…

- âœ… ç»„ä»¶å°ºå¯¸ä¸URDFæ–‡ä»¶å®Œå…¨åŒ¹é…
- âœ… ä½ç½®è®¡ç®—åŸºäºURDFçš„jointå®šä¹‰
- âœ… é¢œè‰²ä¸URDFçš„materialå®šä¹‰ä¸€è‡´
- âœ… æ‰€æœ‰ç¯å¢ƒçš„actoræ•°é‡ä¿æŒä¸€è‡´

### æ€§èƒ½ âœ…

- âœ… Asseté‡ç”¨ï¼Œä¸é‡å¤åˆ›å»º
- âœ… ä½¿ç”¨setå»é‡é…ç½®
- âœ… é™æ€å‡ ä½•ä½“ï¼Œå›ºå®šä¸åŠ¨
- âœ… ç¦ç”¨é‡åŠ›ï¼Œå‡å°‘è®¡ç®—

### å¯ç»´æŠ¤æ€§ âœ…

- âœ… æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- âœ… å‚æ•°åŒ–è®¾è®¡ï¼Œæ˜“äºè°ƒæ•´
- âœ… æ¨¡å—åŒ–å‡½æ•°ï¼ŒèŒè´£å•ä¸€
- âœ… é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ£€æŸ¥

### å…¼å®¹æ€§ âœ…

- âœ… å‘åå…¼å®¹ç°æœ‰ä»£ç 
- âœ… ä¸å½±å“å…¶ä»–åœ°å½¢ç±»å‹
- âœ… å¯ä¸å…¶ä»–éšœç¢ç‰©æ··åˆä½¿ç”¨
- âœ… Isaac Gym APIæ­£ç¡®ä½¿ç”¨

## ğŸ“ å­¦åˆ°çš„ç»éªŒ

### Isaac Gym æœ€ä½³å®è·µ

1. **å¤åˆå¯¹è±¡åˆ›å»º**: ä½¿ç”¨å¤šä¸ªç®€å•å‡ ä½•ä½“ç»„åˆï¼Œè€Œä¸æ˜¯å¤æ‚URDF
2. **Asseté‡ç”¨**: åˆ›å»ºä¸€æ¬¡assetï¼Œå¤šæ¬¡ä½¿ç”¨
3. **Collision Group**: ä½¿ç”¨ç‹¬ç«‹çš„collision groupéš”ç¦»é™æ€éšœç¢ç‰©
4. **æ€§èƒ½ä¼˜åŒ–**: fix_base_link=True, disable_gravity=True

### åæ ‡ç³»è½¬æ¢

- Height fieldåæ ‡ â†’ ä¸–ç•Œåæ ‡
- URDF localåæ ‡ â†’ Isaac Gymä¸–ç•Œåæ ‡
- æ—‹è½¬è¡¨ç¤º: Quat.from_axis_angle()

### è°ƒè¯•æŠ€å·§

- ä½¿ç”¨é¢œè‰²åŒºåˆ†ç»„ä»¶
- æ‰“å°å…³é”®ä½ç½®ä¿¡æ¯
- é€ä¸ªç»„ä»¶æ·»åŠ ï¼ŒéªŒè¯ä½ç½®

## ğŸ”„ æœªæ¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸæ”¹è¿›

1. **å‚æ•°éªŒè¯**: æ·»åŠ è¾“å…¥å‚æ•°èŒƒå›´æ£€æŸ¥
2. **é”™è¯¯å¤„ç†**: æ›´å®Œå–„çš„å¼‚å¸¸å¤„ç†
3. **æ—¥å¿—è¾“å‡º**: æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

### ä¸­æœŸæ”¹è¿›

1. **æ›´å¤šå˜ä½“**: åˆ›å»ºä¸åŒå½¢çŠ¶çš„æ æ†ï¼ˆLå‹ã€Tå‹ç­‰ï¼‰
2. **åŠ¨æ€é«˜åº¦**: æ ¹æ®è®­ç»ƒè¿›åº¦è‡ªåŠ¨è°ƒæ•´é«˜åº¦
3. **ç¢°æ’æ£€æµ‹**: æ·»åŠ æ æ†ç¢°æ’æ£€æµ‹å¥–åŠ±

### é•¿æœŸæ”¹è¿›

1. **ç‰©ç†äº¤äº’**: ä½¿æ æ†å¯ä»¥è¢«æ¨å€’ï¼ˆåŠ¨æ€åˆšä½“ï¼‰
2. **ç¨‹åºåŒ–ç”Ÿæˆ**: æ›´å¤šç±»å‹çš„éšœç¢ç‰©
3. **è¯¾ç¨‹å­¦ä¹ **: æ™ºèƒ½éš¾åº¦è°ƒæ•´

## âœ… éªŒè¯æ¸…å•

åœ¨é›†æˆåˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼Œç¡®è®¤ï¼š

- âœ… ä»£ç é€šè¿‡linteræ£€æŸ¥
- âœ… æ²¡æœ‰importé”™è¯¯
- âœ… æ‰€æœ‰å‡½æ•°æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- âœ… å‚æ•°æœ‰åˆç†çš„é»˜è®¤å€¼
- âœ… åˆ›å»ºçš„æŒ‡å—æ–‡æ¡£å®Œæ•´
- âœ… ç¤ºä¾‹ä»£ç å¯è¿è¡Œ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **terrain.py ç¬¬75-77è¡Œ**: `h_hurdles_dict` æ˜¯å¦åˆå§‹åŒ–
2. **terrain.py ç¬¬545-555è¡Œ**: æ˜¯å¦æ­£ç¡®å­˜å‚¨æ æ†ä¿¡æ¯
3. **legged_robot.py ç¬¬1242-1249è¡Œ**: æ˜¯å¦è°ƒç”¨ `_create_h_hurdle_assets()`
4. **legged_robot.py ç¬¬1365-1368è¡Œ**: æ˜¯å¦è°ƒç”¨ `_add_h_hurdle_static_geometry()`

## ğŸ‰ æ€»ç»“

æˆåŠŸå®ç°äº†ï¼š

1. âœ… **ç¨‹åºåŒ–Hå‹æ æ†ç”Ÿæˆ** - å®Œæ•´çš„6ç»„ä»¶ç»“æ„
2. âœ… **é«˜æ•ˆçš„Assetç®¡ç†** - é‡ç”¨å’Œç¼“å­˜
3. âœ… **çµæ´»çš„å‚æ•°é…ç½®** - æ˜“äºè°ƒæ•´å’Œæ‰©å±•
4. âœ… **å®Œæ•´çš„æ–‡æ¡£** - ä½¿ç”¨æŒ‡å—å’Œé›†æˆæ­¥éª¤
5. âœ… **Isaac Gymå…¼å®¹** - éµå¾ªæœ€ä½³å®è·µ

è¿™ä¸ªå®ç°ä¸ºä½ çš„æœºå™¨äººè®­ç»ƒæä¾›äº†ï¼š
- ğŸ¯ æ›´çœŸå®çš„éšœç¢ç‰©æŒ‘æˆ˜
- âš¡ æ›´å¥½çš„æ€§èƒ½å’Œæ•ˆç‡
- ğŸ”§ æ›´å¤§çš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§
- ğŸ“ˆ æ›´å¥½çš„è®­ç»ƒç¯å¢ƒå¤šæ ·æ€§

ç¥è®­ç»ƒé¡ºåˆ©ï¼ğŸš€ğŸ¤–

